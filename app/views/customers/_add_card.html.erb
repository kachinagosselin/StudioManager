<script>
Stripe.setPublishableKey($('meta[name="stripe-key"]').attr('content'));
$(document).ready(function() {
  $("#add_card").submit(function(event) {
    // disable the submit button to prevent repeated clicks
    $('.submit-button').attr("disabled", "disabled");
    var card_number = document.getElementById('card_number').value;
    var card_code = document.getElementById('card_code').value;
    var card_month = document.getElementById('card_month').value;
    var card_year = document.getElementById('card_year').value;
    
    var end = card_number.length;
    var last_4_digits = card_number[end-4]+card_number[end-3]+card_number[end-2]+card_number[end-1];
    $("#add_card").append("<input type='hidden' name='last_4_digits' value='" + last_4_digits + "'/>");
    
    Stripe.createToken({
        number: $('#card_number').val(),
        cvc: $('#card_code').val(),
        exp_month: $('#card_month').val(),
        exp_year: $('#card_year').val()
    }, stripeResponseHandler);

    // prevent the form from submitting with the default action
    return false;
  });
});

<%= form_for([current_user, current_user.build_customer], :html => { :class => 'form-vertical', :remote => true, :id => "add_card" }) do |c| %>

        <div class="form-group" >
          <%= label_tag :card_number, "Credit Card Number" %>
          <%=h text_field_tag :card_number, nil, name: nil, :class => "form-control"  %>
 
          <div class="form-group col-lg-4">
          <%= label_tag :card_code, "Security Code (CVV)" %>
          <%=h text_field_tag :card_code, nil, name: nil, :class => "form-control"  %>
          </div>
          <div class="form-group col-lg-4">
          <%= label_tag :card_month, "Card Expiration" %>
          <%=h text_field_tag :card_month, nil, name: nil, :class => 'datepicker form-control'  %>
          </div>
          <div class="form-group col-lg-4">
          <%= label_tag :card_year, " " %>
          <%=h text_field_tag :card_year, nil, name: nil, :class => 'datepicker form-control'  %>
          </div>

        <%= c.submit "Add Card", :class =>"submit-button btn btn-primary pull-right", :id => "add_card"%> 
        </div>
<% end %>
